(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-528a0184"],{3993:function(t,e,a){"use strict";var n=function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("div",[a("a-drawer",{attrs:{title:t.title,width:t.isMobile()?"100%":t.drawerWidth,closable:"",visible:t.visible,destroyOnClose:""},on:{close:t.onClose}},[a("a-row",{attrs:{type:"flex",align:"middle"}},[a("a-input-search",{attrs:{placeholder:"搜索附件",enterButton:""},on:{search:function(e){return t.handleQuery()}},model:{value:t.queryParam.keyword,callback:function(e){t.$set(t.queryParam,"keyword",e)},expression:"queryParam.keyword"}})],1),a("a-divider"),a("a-row",{attrs:{type:"flex",align:"middle"}},[a("a-skeleton",{attrs:{active:"",loading:t.skeletonLoading,paragraph:{rows:18}}},[a("a-col",{attrs:{span:24}},[0==t.attachments.length?a("a-empty"):t._l(t.attachments,(function(e,n){return a("div",{key:n,staticClass:"attach-item",on:{click:function(a){return t.handleSelectAttachment(e)}}},[a("span",{directives:[{name:"show",rawName:"v-show",value:!t.handleJudgeMediaType(e),expression:"!handleJudgeMediaType(item)"}]},[t._v("当前格式不支持预览")]),a("img",{directives:[{name:"show",rawName:"v-show",value:t.handleJudgeMediaType(e),expression:"handleJudgeMediaType(item)"}],attrs:{src:e.thumbPath,loading:"lazy"}})])}))],2)],1)],1),a("a-divider"),a("div",{staticClass:"page-wrapper"},[a("a-pagination",{attrs:{current:t.pagination.page,total:t.pagination.total,defaultPageSize:t.pagination.size},on:{change:t.handlePaginationChange}})],1),a("a-divider",{staticClass:"divider-transparent"}),a("div",{staticClass:"bottom-control"},[t.isChooseAvatar?a("a-button",{staticStyle:{marginRight:"8px"},attrs:{type:"dashed"},on:{click:t.handleSelectGravatar}},[t._v("使用 Gravatar")]):t._e(),a("a-button",{attrs:{type:"primary"},on:{click:t.handleShowUploadModal}},[t._v("上传附件")])],1)],1),a("a-modal",{attrs:{title:"上传附件",footer:null,afterClose:t.onUploadClose,destroyOnClose:""},model:{value:t.uploadVisible,callback:function(e){t.uploadVisible=e},expression:"uploadVisible"}},[a("FilePondUpload",{ref:"upload",attrs:{uploadHandler:t.uploadHandler}})],1)],1)},o=[],i=(a("28a5"),a("55dd"),a("c5f6"),a("ac0d")),r=a("a796"),l={name:"AttachmentSelectDrawer",mixins:[i["a"],i["b"]],model:{prop:"visible",event:"close"},props:{visible:{type:Boolean,required:!1,default:!1},drawerWidth:{type:Number,required:!1,default:480},title:{type:String,required:!1,default:"选择附件"},isChooseAvatar:{type:Boolean,required:!1,default:!1}},data:function(){return{uploadVisible:!1,skeletonLoading:!0,pagination:{page:1,size:12,sort:null,total:1},queryParam:{page:0,size:12,sort:null,keyword:null},attachments:[],uploadHandler:r["a"].upload}},watch:{visible:function(t,e){t&&(this.loadSkeleton(),this.loadAttachments())}},methods:{loadSkeleton:function(){var t=this;this.skeletonLoading=!0,setTimeout((function(){t.skeletonLoading=!1}),500)},handleShowUploadModal:function(){this.uploadVisible=!0},loadAttachments:function(){var t=this;this.queryParam.page=this.pagination.page-1,this.queryParam.size=this.pagination.size,this.queryParam.sort=this.pagination.sort,r["a"].query(this.queryParam).then((function(e){t.attachments=e.data.data.content,t.pagination.total=e.data.data.total}))},handleQuery:function(){this.handlePaginationChange(1,this.pagination.size)},handleSelectAttachment:function(t){this.$emit("listenToSelect",t)},handleSelectGravatar:function(){this.$emit("listenToSelectGravatar")},handlePaginationChange:function(t,e){this.pagination.page=t,this.pagination.size=e,this.loadAttachments()},onUploadClose:function(){this.$refs.upload.handleClearFileList(),this.loadSkeleton(),this.handlePaginationChange(1,this.pagination.size)},handleJudgeMediaType:function(t){var e=t.mediaType;if(e){var a=e.split("/")[0];return"image"===a}return!1},onClose:function(){this.$emit("close",!1)}}},s=l,c=a("2877"),d=Object(c["a"])(s,n,o,!1,null,null,null);e["a"]=d.exports},a796:function(t,e,a){"use strict";var n=a("cebe"),o=a.n(n),i=a("9efd"),r="/api/admin/attachments",l={query:function(t){return Object(i["a"])({url:r,params:t,method:"get"})},get:function(t){return Object(i["a"])({url:"".concat(r,"/").concat(t),method:"get"})},delete:function(t){return Object(i["a"])({url:"".concat(r,"/").concat(t),method:"delete"})},deleteInBatch:function(t){return Object(i["a"])({url:"".concat(r),method:"delete",data:t,headers:{"Content-Type":"application/json;charset=UTF-8"}})},update:function(t,e){return Object(i["a"])({url:"".concat(r,"/").concat(t),method:"put",data:e})},getMediaTypes:function(){return Object(i["a"])({url:"".concat(r,"/media_types"),method:"get"})},getTypes:function(){return Object(i["a"])({url:"".concat(r,"/types"),method:"get"})}};l.CancelToken=o.a.CancelToken,l.isCancel=o.a.isCancel,l.upload=function(t,e,a){return Object(i["a"])({url:"".concat(r,"/upload"),timeout:864e4,data:t,onUploadProgress:e,cancelToken:a,method:"post"})},l.uploads=function(t,e,a){return Object(i["a"])({url:"".concat(r,"/uploads"),timeout:864e4,data:t,onUploadProgress:e,cancelToken:a,method:"post"})},l.type={LOCAL:{type:"LOCAL",text:"本地"},SMMS:{type:"SMMS",text:"SM.MS"},UPOSS:{type:"UPOSS",text:"又拍云"},QINIUOSS:{type:"QINIUOSS",text:"七牛云"},ALIOSS:{type:"ALIOSS",text:"阿里云"},BAIDUBOS:{type:"BAIDUBOS",text:"百度云"},TENCENTCOS:{type:"TENCENTCOS",text:"腾讯云"}},e["a"]=l},aa1e:function(t,e,a){"use strict";a.r(e);var n=function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("div",[a("a-row",{attrs:{gutter:12}},[a("a-col",{style:{"padding-bottom":"12px"},attrs:{xl:10,lg:10,md:10,sm:24,xs:24}},[a("a-card",{attrs:{title:t.title,bodyStyle:{padding:"16px"}}},[a("a-form",{attrs:{layout:"horizontal"}},[a("a-form-item",{attrs:{label:"名称：",help:"* 页面上所显示的名称"}},[a("a-input",{model:{value:t.tagToCreate.name,callback:function(e){t.$set(t.tagToCreate,"name",e)},expression:"tagToCreate.name"}})],1),a("a-form-item",{attrs:{label:"别名：",help:"* 一般为单个标签页面的标识，最好为英文"}},[a("a-input",{model:{value:t.tagToCreate.slug,callback:function(e){t.$set(t.tagToCreate,"slug",e)},expression:"tagToCreate.slug"}})],1),a("a-form-item",{attrs:{label:"封面图：",help:"* 在标签页面可展示，需要主题支持"}},[a("a-input",{model:{value:t.tagToCreate.thumbnail,callback:function(e){t.$set(t.tagToCreate,"thumbnail",e)},expression:"tagToCreate.thumbnail"}},[a("a",{attrs:{slot:"addonAfter",href:"javascript:void(0);"},on:{click:function(e){t.thumbnailDrawerVisible=!0}},slot:"addonAfter"},[a("a-icon",{attrs:{type:"picture"}})],1)])],1),a("a-form-item",["create"===t.formType?a("a-button",{attrs:{type:"primary"},on:{click:t.handleSaveClick}},[t._v("保存")]):a("a-button-group",[a("a-button",{attrs:{type:"primary"},on:{click:t.handleSaveClick}},[t._v("更新")]),"update"===t.formType?a("a-button",{attrs:{type:"dashed"},on:{click:t.handleAddTag}},[t._v("返回添加")]):t._e()],1),"update"===t.formType?a("a-popconfirm",{attrs:{title:"你确定要删除【"+t.tagToCreate.name+"】标签？",okText:"确定",cancelText:"取消"},on:{confirm:function(e){return t.handleDeleteTag(t.tagToCreate.id)}}},[a("a-button",{staticStyle:{float:"right"},attrs:{type:"danger"}},[t._v("删除")])],1):t._e()],1)],1)],1)],1),a("a-col",{style:{"padding-bottom":"12px"},attrs:{xl:14,lg:14,md:14,sm:24,xs:24}},[a("a-card",{attrs:{title:"所有标签",bodyStyle:{padding:"16px"}}},[0==t.tags.length?a("a-empty"):t._l(t.tags,(function(e){return a("a-tooltip",{key:e.id,attrs:{placement:"topLeft"}},[a("template",{slot:"title"},[a("span",[t._v(t._s(e.postCount)+" 篇文章")])]),a("a-tag",{staticStyle:{"margin-bottom":"8px",cursor:"pointer"},attrs:{color:"blue"},on:{click:function(a){return t.handleEditTag(e)}}},[t._v(t._s(e.name))])],2)}))],2)],1)],1),a("AttachmentSelectDrawer",{attrs:{title:"选择封面图"},on:{listenToSelect:t.handleSelectThumbnail},model:{value:t.thumbnailDrawerVisible,callback:function(e){t.thumbnailDrawerVisible=e},expression:"thumbnailDrawerVisible"}})],1)},o=[],i=(a("7f7f"),a("d28d")),r=a("3993"),l={components:{AttachmentSelectDrawer:r["a"]},data:function(){return{formType:"create",tags:[],tagToCreate:{},thumbnailDrawerVisible:!1}},computed:{title:function(){return this.tagToCreate.id?"修改标签":"添加标签"}},created:function(){this.loadTags()},methods:{loadTags:function(){var t=this;i["a"].listAll(!0).then((function(e){t.tags=e.data.data}))},handleSaveClick:function(){this.createOrUpdateTag()},handleAddTag:function(){this.formType="create",this.tagToCreate={}},handleEditTag:function(t){this.tagToCreate=t,this.formType="update"},handleDeleteTag:function(t){var e=this;i["a"].delete(t).then((function(t){e.$message.success("删除成功！"),e.loadTags(),e.handleAddTag()}))},createOrUpdateTag:function(){var t=this;this.tagToCreate.name?(this.tagToCreate.id?i["a"].update(this.tagToCreate.id,this.tagToCreate).then((function(e){t.$message.success("更新成功！"),t.loadTags(),t.tagToCreate={}})):i["a"].create(this.tagToCreate).then((function(e){t.$message.success("保存成功！"),t.loadTags(),t.tagToCreate={}})),this.handleAddTag()):this.$notification["error"]({message:"提示",description:"标签名称不能为空！"})},handleSelectThumbnail:function(t){this.$set(this.tagToCreate,"thumbnail",encodeURI(t.path)),this.thumbnailDrawerVisible=!1}}},s=l,c=a("2877"),d=Object(c["a"])(s,n,o,!1,null,null,null);e["default"]=d.exports},d28d:function(t,e,a){"use strict";var n=a("9efd"),o="/api/admin/tags",i={listAll:function(){var t=arguments.length>0&&void 0!==arguments[0]&&arguments[0];return Object(n["a"])({url:o,params:{more:t},method:"get"})},createWithName:function(t){return Object(n["a"])({url:o,data:{name:t},method:"post"})},create:function(t){return Object(n["a"])({url:o,data:t,method:"post"})},update:function(t,e){return Object(n["a"])({url:"".concat(o,"/").concat(t),data:e,method:"put"})},delete:function(t){return Object(n["a"])({url:"".concat(o,"/").concat(t),method:"delete"})}};e["a"]=i}}]);